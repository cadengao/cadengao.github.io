{
  "UUID": "54197723.189486255",
  "DocId": 0,
  "Type": null,
  "Format": null,
  "Title": "\u5728netlify\u4E0A\u90E8\u7F72\u4E91\u51FD\u6570\u3010Resource\u3011",
  "TagDatas": null,
  "Slug": null,
  "Tags": null,
  "Description": null,
  "Cover": null,
  "BookId": 0,
  "BookName": null,
  "Public": 0,
  "WordCount": 0,
  "CreatedAt": "0001-01-01T00:00:00",
  "UpdatedAt": "0001-01-01T00:00:00",
  "BodyHtml": "\u003C!doctype html\u003E\u003Cdiv class=\u0022lake-content\u0022 typography=\u0022classic\u0022\u003E\u003Ch1 id=\u0022BsgHY\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u63A8\u9001\u4EE3\u7801\u5230github\u4E0A\u003C/span\u003E\u003C/h1\u003E\u003Col class=\u0022ne-ol\u0022\u003E\u003Cli id=\u0022uadb7403e\u0022 data-lake-index-type=\u00220\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u5B89\u88C5node.js\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022u23fddc6b\u0022 data-lake-index-type=\u00220\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u6267\u884C\u8BED\u53E5\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003Enpm install mysql2\u003C/span\u003E\u003C/code\u003E\u003C/li\u003E\u003Cli id=\u0022u4ead6212\u0022 data-lake-index-type=\u00220\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u6839\u76EE\u5F55\u65B0\u5EFA\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003Enetlify.toml\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u6587\u4EF6\u548C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003Efunctions\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u76EE\u5F55\u4E0B\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003Ehello.js\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u548C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003Emysql.js\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u6587\u4EF6\u003C/span\u003E\u003C/li\u003E\u003C/ol\u003E\u003Cspan style=\u0022margin-left: 2em\u0022\u003E\u003Cpre data-language=\u0022toml\u0022 id=\u0022JQrl3\u0022 class=\u0022ne-codeblock language-toml\u0022\u003E\u003Ccode\u003E[build] \nfunctions = \u0026quot;functions\u0026quot;\u003C/code\u003E\u003C/pre\u003E\u003C/span\u003E\u003Cspan style=\u0022margin-left: 2em\u0022\u003E\u003Cpre data-language=\u0022javascript\u0022 id=\u0022HPAVm\u0022 class=\u0022ne-codeblock language-javascript\u0022\u003E\u003Ccode\u003Econst mysql = require(\u0027mysql2/promise\u0027);\n\n// \u83B7\u53D6\u6570\u636E\u5E93\u8FDE\u63A5\u914D\u7F6E\nconst connectionConfig = {\n  host: process.env.DB_HOST,\n  port: process.env.DB_PORT,\n  user: process.env.DB_USER,\n  password: process.env.DB_PASSWORD,\n  database: process.env.DB_NAME\n};\n\n// \u5B58\u50A8 SQL \u67E5\u8BE2\u7ED3\u679C\u7684\u7F13\u5B58\nlet queryCache = {};\n\nexports.handler = async (event, context) =\u0026gt; {\n  // \u89E3\u6790\u67E5\u8BE2\u5B57\u7B26\u4E32\u53C2\u6570\n  const { sql } = event.queryStringParameters || {};\n\n  // \u5982\u679C\u4F20\u5165\u7684 sql \u4E3A\u7A7A\uFF0C\u6E05\u7A7A\u7F13\u5B58\n  if (!sql) {\n    queryCache = {};  // \u6E05\u7A7A\u7F13\u5B58\n    return {\n      statusCode: 200,\n      headers: {\n        \u0027Access-Control-Allow-Origin\u0027: \u0027*\u0027, // \u5141\u8BB8\u7684\u6765\u6E90\n        \u0027Content-Type\u0027: \u0027application/json\u0027 // \u8BBE\u7F6E\u5185\u5BB9\u7C7B\u578B\n      },\n      body: JSON.stringify({ message: \u0027Query cache cleared.\u0027 }),\n    };\n  }\n\n  // \u8FD4\u56DE\u9519\u8BEF\u4FE1\u606F\uFF0C\u5982\u679C sql \u4E3A\u7A7A\u6216\u65E0\u6548\n  if (!sql.trim()) {\n    return {\n      statusCode: 400,\n      headers: {\n        \u0027Access-Control-Allow-Origin\u0027: \u0027*\u0027, // \u5141\u8BB8\u7684\u6765\u6E90\n        \u0027Content-Type\u0027: \u0027application/json\u0027 // \u8BBE\u7F6E\u5185\u5BB9\u7C7B\u578B\n      },\n      body: JSON.stringify({ message: \u0027SQL query is required.\u0027 }),\n    };\n  }\n\n  // \u68C0\u67E5\u7F13\u5B58\u4E2D\u662F\u5426\u5DF2\u5B58\u5728\u67E5\u8BE2\u7ED3\u679C\n  if (queryCache[sql]) {\n    return {\n      statusCode: 200,\n      headers: {\n        \u0027Access-Control-Allow-Origin\u0027: \u0027*\u0027, // \u5141\u8BB8\u7684\u6765\u6E90\n        \u0027Content-Type\u0027: \u0027application/json\u0027 // \u8BBE\u7F6E\u5185\u5BB9\u7C7B\u578B\n      },\n      body: JSON.stringify(JSON.parse(queryCache[sql])),\n    };\n  }\n\n  try {\n    // \u521B\u5EFA\u6570\u636E\u5E93\u8FDE\u63A5\n    const connection = await mysql.createConnection(connectionConfig);\n\n    // \u6267\u884C\u67E5\u8BE2\n    const [rows] = await connection.execute(sql);\n\n    // \u5C06\u7ED3\u679C\u5B58\u5165\u7F13\u5B58\n    queryCache[sql] = JSON.stringify(rows);\n\n    // \u5173\u95ED\u8FDE\u63A5\n    await connection.end();\n\n    // \u8FD4\u56DE\u67E5\u8BE2\u7ED3\u679C\n    return {\n      statusCode: 200,\n      headers: {\n        \u0027Access-Control-Allow-Origin\u0027: \u0027*\u0027, // \u5141\u8BB8\u7684\u6765\u6E90\n        \u0027Content-Type\u0027: \u0027application/json\u0027 // \u8BBE\u7F6E\u5185\u5BB9\u7C7B\u578B\n      },\n      body: JSON.stringify(rows),\n    };\n  } catch (error) {\n    console.error(\u0027Database query error:\u0027, error);\n    return {\n      statusCode: 500,\n      headers: {\n        \u0027Access-Control-Allow-Origin\u0027: \u0027*\u0027, // \u5141\u8BB8\u7684\u6765\u6E90\n        \u0027Content-Type\u0027: \u0027application/json\u0027 // \u8BBE\u7F6E\u5185\u5BB9\u7C7B\u578B\n      },\n      body: JSON.stringify({ message: \u0027Internal Server Error\u0027, error: error.message }),\n    };\n  }\n};\n\u003C/code\u003E\u003C/pre\u003E\u003C/span\u003E\u003Col start=\u00224\u0022 class=\u0022ne-ol\u0022\u003E\u003Cli id=\u0022ue98ab9d2\u0022 data-lake-index-type=\u00220\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u7ED3\u6784\u5982\u4E0B\u56FE\u003C/span\u003E\u003C/li\u003E\u003C/ol\u003E\u003Cp id=\u0022u1439d32f\u0022 class=\u0022ne-p\u0022 style=\u0022margin-left: 2em\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197723.189486255/image/0.png\u0022 width=\u0022152\u0022 id=\u0022u6d6bda24\u0022 class=\u0022ne-image\u0022\u003E\u003C/p\u003E\u003Ch1 id=\u0022GGJaJ\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u5728netlify\u4E0A\u90E8\u7F72\u8BE5\u4EE3\u7801\u003C/span\u003E\u003C/h1\u003E\u003Col class=\u0022ne-ol\u0022\u003E\u003Cli id=\u0022uc655b7a9\u0022 data-lake-index-type=\u00220\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u90E8\u7F72\u5B8C\u6210\u540E\uFF0C\u6DFB\u52A0\u73AF\u5883\u53D8\u91CF\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022u31d0fa69\u0022 data-lake-index-type=\u00220\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u6D4B\u8BD5\u003C/span\u003E\u003C/li\u003E\u003C/ol\u003E\u003Cspan style=\u0022margin-left: 2em\u0022\u003E\u003Cpre data-language=\u0022toml\u0022 id=\u0022qMqtJ\u0022 class=\u0022ne-codeblock language-toml\u0022\u003E\u003Ccode\u003E1\u3001\u6D4F\u89C8\u5668\u6253\u5F00https://cadenbaseapi.netlify.app/.netlify/functions/hello\n   \u4F1A\u51FA\u73B0\u7ED3\u679C\n{\u0026quot;message\u0026quot;:\u0026quot;Hello from Netlify!\u0026quot;}\n\n2\u3001\u6D4F\u89C8\u5668\u6253\u5F00https://cadenbaseapi.netlify.app/.netlify/functions/mysql\n   \u4F1A\u51FA\u73B0\u7ED3\u679C,\u5982\u679C\u6709\u53C2\u6570\uFF0C\u5219\u540E\u9762\u52A0\u4E0A\u201C?sql= select * from tb_doc\u201D\n{\u0026quot;message\u0026quot;: \u0026quot;Query cache cleared.\u0026quot;}\n\u003C/code\u003E\u003C/pre\u003E\u003C/span\u003E\u003C/div\u003E",
  "Body": null,
  "CosUpdatedAt": "0001-01-01T00:00:00",
  "BodyHtmlCosUrl": null
}