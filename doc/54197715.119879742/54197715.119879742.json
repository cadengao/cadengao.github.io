{
  "UUID": "54197715.119879742",
  "DocId": 0,
  "Type": null,
  "Format": null,
  "Title": "C#-\u7EBF\u7A0B\u540C\u6B65\u3010Area\u3011",
  "TagDatas": null,
  "Slug": null,
  "Tags": null,
  "Description": null,
  "Cover": null,
  "BookId": 0,
  "BookName": null,
  "Public": 0,
  "WordCount": 0,
  "CreatedAt": "0001-01-01T00:00:00",
  "UpdatedAt": "0001-01-01T00:00:00",
  "BodyHtml": "\u003C!doctype html\u003E\u003Cdiv class=\u0022lake-content\u0022 typography=\u0022classic\u0022\u003E\u003Ch2 id=\u0022FWQT0\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u7B80\u4ECB\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022u4a350ed4\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u672C\u7AE0\u4ECB\u7ECD\u5728C#\u4E2D\u5B9E\u73B0\u7EBF\u7A0B\u540C\u6B65\u7684\u51E0\u79CD\u65B9\u6CD5\u3002\u56E0\u4E3A\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8BBF\u95EE\u5171\u4EAB\u6570\u636E\u65F6\uFF0C\u53EF\u80FD\u4F1A\u9020\u6210\u5171\u4EAB\u6570\u636E\u7684\u635F\u574F\uFF0C\u4ECE\u800C\u5BFC\u81F4\u4E0E\u9884\u671F\u7684\u7ED3\u679C\u4E0D\u76F8\u7B26\u3002\u4E3A\u4E86\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u6240\u4EE5\u9700\u8981\u7528\u5230\u7EBF\u7A0B\u540C\u6B65\uFF0C\u4E5F\u88AB\u4FD7\u79F0\u4E3A\u201C\u52A0\u9501\u201D\u3002\u4F46\u662F\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u52A0\u9501\u7EDD\u5BF9\u4E0D\u5BF9\u63D0\u9AD8\u6027\u80FD\uFF0C\u6700\u591A\u4E5F\u5C31\u662F\u4E0D\u589E\u4E0D\u51CF\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u8981\u5B9E\u73B0\u6027\u80FD\u4E0D\u589E\u4E0D\u51CF\u8FD8\u5F97\u9760\u9AD8\u8D28\u91CF\u7684\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u540C\u6B65\u6E90\u8BED\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E(Synchronization Primitive)\u3002\u4F46\u662F\u56E0\u4E3A\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6B63\u786E\u6C38\u8FDC\u6BD4\u901F\u5EA6\u66F4\u91CD\u8981\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u6240\u4EE5\u7EBF\u7A0B\u540C\u6B65\u5728\u67D0\u4E9B\u573A\u666F\u4E0B\u662F\u5FC5\u987B\u7684\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u556ddc7f\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7EBF\u7A0B\u540C\u6B65\u6709\u4E24\u79CD\u6E90\u8BED(Primitive)\u6784\u9020\uFF1A\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7528\u6237\u6A21\u5F0F(user - mode)\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u548C\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5185\u6838\u6A21\u5F0F(kernel - mode)\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u5F53\u8D44\u6E90\u53EF\u7528\u65F6\u95F4\u77ED\u7684\u60C5\u51B5\u4E0B\uFF0C\u7528\u6237\u6A21\u5F0F\u8981\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4F18\u4E8E\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5185\u6838\u6A21\u5F0F\uFF0C\u4F46\u662F\u5982\u679C\u957F\u65F6\u95F4\u4E0D\u80FD\u83B7\u5F97\u8D44\u6E90\uFF0C\u6216\u8005\u8BF4\u957F\u65F6\u95F4\u5904\u4E8E\u201C\u81EA\u65CB\u201D\uFF0C\u90A3\u4E48\u5185\u6838\u6A21\u5F0F\u662F\u76F8\u5BF9\u6765\u8BF4\u597D\u7684\u9009\u62E9\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u356cae7b\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4F46\u662F\u6211\u4EEC\u5E0C\u671B\u517C\u5177\u7528\u6237\u6A21\u5F0F\u548C\u5185\u6838\u6A21\u5F0F\u7684\u4F18\u70B9\uFF0C\u6211\u4EEC\u628A\u5B83\u79F0\u4E3A\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6DF7\u5408\u6784\u9020(hybrid construct)\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u5B83\u517C\u5177\u4E86\u4E24\u79CD\u6A21\u5F0F\u7684\u4F18\u70B9\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u8a97b114\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5728C#\u4E2D\u6709\u591A\u79CD\u7EBF\u7A0B\u540C\u6B65\u7684\u673A\u5236\uFF0C\u901A\u5E38\u53EF\u4EE5\u6309\u7167\u4EE5\u4E0B\u987A\u5E8F\u8FDB\u884C\u9009\u62E9\u3002\u003C/span\u003E\u003C/p\u003E\u003Cdiv class=\u0022ne-quote\u0022\u003E\u003Col class=\u0022ne-ol\u0022\u003E\u003Cli id=\u0022ue0fcb134\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5982\u679C\u4EE3\u7801\u80FD\u901A\u8FC7\u4F18\u5316\u53EF\u4EE5\u4E0D\u8FDB\u884C\u540C\u6B65\uFF0C\u90A3\u4E48\u5C31\u4E0D\u8981\u505A\u540C\u6B65\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022u14a86c87\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4F7F\u7528\u539F\u5B50\u6027\u7684\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EInterlocked\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65B9\u6CD5\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022ud2796a9b\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4F7F\u7528\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Elock/Monitor\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022u35b82a49\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4F7F\u7528\u5F02\u6B65\u9501\uFF0C\u5982\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESemaphoreSlim.WaitAsync()\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022ua9456a58\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4F7F\u7528\u5176\u5B83\u52A0\u9501\u673A\u5236\uFF0C\u5982\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EReaderWriterLockSlim\u3001Mutex\u3001Semaphore\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7B49\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022uc8446999\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5982\u679C\u7CFB\u7EDF\u63D0\u4F9B\u4E86\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E*Slim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7248\u672C\u7684\u5F02\u6B65\u5BF9\u8C61\uFF0C\u90A3\u4E48\u8BF7\u9009\u7528\u5B83\uFF0C\u56E0\u4E3A\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E*Slim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7248\u672C\u5168\u90E8\u90FD\u662F\u6DF7\u5408\u9501\uFF0C\u5728\u8FDB\u5165\u5185\u6838\u6A21\u5F0F\u524D\u5B9E\u73B0\u4E86\u67D0\u79CD\u5F62\u5F0F\u7684\u81EA\u65CB\u3002\u003C/span\u003E\u003C/li\u003E\u003C/ol\u003E\u003C/div\u003E\u003Cp id=\u0022u004a977a\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5728\u540C\u6B65\u4E2D\uFF0C\u4E00\u5B9A\u8981\u6CE8\u610F\u907F\u514D\u6B7B\u9501\u7684\u53D1\u751F\uFF0C\u6B7B\u9501\u7684\u53D1\u751F\u5FC5\u987B\u6EE1\u8DB3\u4EE5\u4E0B4\u4E2A\u57FA\u672C\u6761\u4EF6\uFF0C\u6240\u4EE5\u53EA\u9700\u8981\u7834\u574F\u4EFB\u610F\u4E00\u4E2A\u6761\u4EF6\uFF0C\u5C31\u53EF\u907F\u514D\u53D1\u751F\u6B7B\u9501\u3002\u003C/span\u003E\u003C/p\u003E\u003Cdiv class=\u0022ne-quote\u0022\u003E\u003Col class=\u0022ne-ol\u0022\u003E\u003Cli id=\u0022u847d14f5\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6392\u4ED6\u6216\u4E92\u65A5(Mutual exclusion)\uFF1A\u4E00\u4E2A\u7EBF\u7A0B(ThreadA)\u72EC\u5360\u4E00\u4E2A\u8D44\u6E90\uFF0C\u6CA1\u6709\u5176\u5B83\u7EBF\u7A0B(ThreadB)\u80FD\u83B7\u53D6\u76F8\u540C\u7684\u8D44\u6E90\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022u803c3e1b\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5360\u6709\u5E76\u7B49\u5F85(Hold and wait)\uFF1A\u4E92\u65A5\u7684\u4E00\u4E2A\u7EBF\u7A0B(ThreadA)\u8BF7\u6C42\u83B7\u53D6\u53E6\u4E00\u4E2A\u7EBF\u7A0B(ThreadB)\u5360\u6709\u7684\u8D44\u6E90.\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022u4bbfe6a3\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4E0D\u53EF\u62A2\u5148(No preemption)\uFF1A\u4E00\u4E2A\u7EBF\u7A0B(ThreadA)\u5360\u6709\u8D44\u6E90\u4E0D\u80FD\u88AB\u5F3A\u5236\u62FF\u8D70(\u53EA\u80FD\u7B49\u5F85ThreadA\u4E3B\u52A8\u91CA\u653E\u5B83\u7684\u8D44\u6E90)\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022ub3e0d6a6\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5FAA\u73AF\u7B49\u5F85\u6761\u4EF6(Circular wait condition)\uFF1A\u4E24\u4E2A\u6216\u591A\u4E2A\u7EBF\u7A0B\u6784\u6210\u4E00\u4E2A\u5FAA\u73AF\u7B49\u5F85\u94FE\uFF0C\u5B83\u4EEC\u9501\u5B9A\u4E24\u4E2A\u6216\u591A\u4E2A\u76F8\u540C\u7684\u8D44\u6E90\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u5728\u7B49\u5F85\u94FE\u4E2D\u7684\u4E0B\u4E00\u4E2A\u7EBF\u7A0B\u5360\u6709\u7684\u8D44\u6E90\u3002\u003C/span\u003E\u003C/li\u003E\u003C/ol\u003E\u003C/div\u003E\u003Ch2 id=\u0022w3Ct5\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u6267\u884C\u57FA\u672C\u539F\u5B50\u64CD\u4F5C\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022udd6bf517\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ECLR\u4FDD\u8BC1\u4E86\u5BF9\u8FD9\u4E9B\u6570\u636E\u7C7B\u578B\u7684\u8BFB\u5199\u662F\u539F\u5B50\u6027\u7684\uFF1A\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EBoolean\u3001Char\u3001(S)Byte\u3001(U)Int16\u3001(U)Int32\u3001(U)IntPtr\u548CSingle\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u3002\u4F46\u662F\u5982\u679C\u8BFB\u5199\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EInt64\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u53EF\u80FD\u4F1A\u53D1\u751F\u8BFB\u53D6\u6495\u88C2(torn read)\u7684\u95EE\u9898\uFF0C\u56E0\u4E3A\u572832\u4F4D\u64CD\u4F5C\u7CFB\u7EDF\u4E2D\uFF0C\u5B83\u9700\u8981\u6267\u884C\u4E24\u6B21\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EMov\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u64CD\u4F5C\uFF0C\u65E0\u6CD5\u5728\u4E00\u4E2A\u65F6\u95F4\u5185\u6267\u884C\u5B8C\u6210\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u6ddd5f49\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u90A3\u4E48\u5728\u672C\u8282\u4E2D\uFF0C\u5C31\u4F1A\u7740\u91CD\u7684\u4ECB\u7ECD\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESystem.Threading.Interlocked\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u63D0\u4F9B\u7684\u65B9\u6CD5\uFF0C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EInterlocked\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u4E2D\u7684\u6BCF\u4E2A\u65B9\u6CD5\u90FD\u662F\u6267\u884C\u4E00\u6B21\u7684\u8BFB\u53D6\u4EE5\u53CA\u5199\u5165\u64CD\u4F5C\u3002\u66F4\u591A\u4E0E\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EInterlocked\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u76F8\u5173\u7684\u8D44\u6599\u8BF7\u53C2\u8003\u94FE\u63A5\uFF0C\u003C/span\u003E\u003Ca href=\u0022https://msdn.microsoft.com/zh-cn/library/system.threading.interlocked(v=vs.110).aspx\u0022 data-href=\u0022https://msdn.microsoft.com/zh-cn/library/system.threading.interlocked(v=vs.110).aspx\u0022 target=\u0022_blank\u0022 class=\u0022ne-link\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u6233\u4E00\u6233\u003C/span\u003E\u003C/a\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u672C\u6587\u4E0D\u5728\u8D58\u8FF0\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u49d2b0a5\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6F14\u793A\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF0C\u5206\u522B\u4F7F\u7528\u4E86\u4E09\u79CD\u65B9\u5F0F\u8FDB\u884C\u8BA1\u6570\uFF1A\u9519\u8BEF\u8BA1\u6570\u65B9\u5F0F\u3001\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Elock\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u9501\u65B9\u5F0F\u548C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EInterlocked\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u539F\u5B50\u65B9\u5F0F\u3002\u003C/span\u003E\u003C/p\u003E\u003Cpre data-language=\u0022csharp\u0022 id=\u0022AwY8I\u0022 class=\u0022ne-codeblock language-csharp\u0022\u003Eprivate static void Main(string[] args)\n{\n    Console.WriteLine(\u0026quot;\u9519\u8BEF\u7684\u8BA1\u6570\u0026quot;);\n\n    var c = new Counter();\n    Execute(c);\n\n    Console.WriteLine(\u0026quot;--------------------------\u0026quot;);\n\n\n    Console.WriteLine(\u0026quot;\u6B63\u786E\u7684\u8BA1\u6570 - \u6709\u9501\u0026quot;);\n\n    var c2 = new CounterWithLock();\n    Execute(c2);\n\n    Console.WriteLine(\u0026quot;--------------------------\u0026quot;);\n\n\n    Console.WriteLine(\u0026quot;\u6B63\u786E\u7684\u8BA1\u6570 - \u65E0\u9501\u0026quot;);\n\n    var c3 = new CounterNoLock();\n    Execute(c3);\n\n    Console.ReadLine();\n}\n\nstatic void Execute(CounterBase c)\n{\n    // \u7EDF\u8BA1\u8017\u65F6\n    var sw = new Stopwatch();\n    sw.Start();\n\n    var t1 = new Thread(() =\u0026gt; TestCounter(c));\n    var t2 = new Thread(() =\u0026gt; TestCounter(c));\n    var t3 = new Thread(() =\u0026gt; TestCounter(c));\n    t1.Start();\n    t2.Start();\n    t3.Start();\n    t1.Join();\n    t2.Join();\n    t3.Join();\n\n    sw.Stop();\n    Console.WriteLine($\u0026quot;Total count: {c.Count} Time:{sw.ElapsedMilliseconds} ms\u0026quot;);\n}\n\nstatic void TestCounter(CounterBase c)\n{\n    for (int i = 0; i \u0026lt; 100000; i\u002B\u002B)\n    {\n        c.Increment();\n        c.Decrement();\n    }\n}\n\nclass Counter : CounterBase\n{\n    public override void Increment()\n    {\n        _count\u002B\u002B;\n    }\n\n    public override void Decrement()\n    {\n        _count--;\n    }\n}\n\nclass CounterNoLock : CounterBase\n{\n    public override void Increment()\n    {\n        // \u4F7F\u7528Interlocked\u6267\u884C\u539F\u5B50\u64CD\u4F5C\n        Interlocked.Increment(ref _count);\n    }\n\n    public override void Decrement()\n    {\n        Interlocked.Decrement(ref _count);\n    }\n}\n\nclass CounterWithLock : CounterBase\n{\n    private readonly object _syncRoot = new Object();\n\n    public override void Increment()\n    {\n        // \u4F7F\u7528Lock\u5173\u952E\u5B57 \u9501\u5B9A\u79C1\u6709\u53D8\u91CF\n        lock (_syncRoot)\n        {\n            // \u540C\u6B65\u5757\n            Count\u002B\u002B;\n        }\n    }\n\n    public override void Decrement()\n    {\n        lock (_syncRoot)\n        {\n            Count--;\n        }\n    }\n}\n\n\nabstract class CounterBase\n{\n    protected int _count;\n\n    public int Count\n    {\n        get\n        {\n            return _count;\n        }\n        set\n        {\n            _count = value;\n        }\n    }\n\n    public abstract void Increment();\n\n    public abstract void Decrement();\n}\n\u003C/pre\u003E\u003Cp id=\u0022u17642f78\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD0\u884C\u7ED3\u679C\u5982\u4E0B\u6240\u793A\uFF0C\u4E0E\u9884\u671F\u7ED3\u679C\u57FA\u672C\u76F8\u7B26\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u06ab2426\u0022 class=\u0022ne-p\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/0.png\u0022 width=\u0022739\u0022 id=\u0022uaa0a1d79\u0022 class=\u0022ne-image\u0022\u003E\u003C/p\u003E\u003Ch2 id=\u0022zNc77\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u4F7F\u7528Mutex\u7C7B\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022ued9d9974\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESystem.Threading.Mutex\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5728\u6982\u5FF5\u4E0A\u548C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESystem.Threading.Monitor\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u51E0\u4E4E\u4E00\u6837\uFF0C\u4F46\u662F\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EMutex\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u540C\u6B65\u5BF9\u6587\u4EF6\u6216\u8005\u5176\u4ED6\u8DE8\u8FDB\u7A0B\u7684\u8D44\u6E90\u8FDB\u884C\u8BBF\u95EE\uFF0C\u4E5F\u5C31\u662F\u8BF4\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EMutex\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u662F\u53EF\u8DE8\u8FDB\u7A0B\u7684\u3002\u56E0\u4E3A\u5176\u7279\u6027\uFF0C\u5B83\u7684\u4E00\u4E2A\u7528\u9014\u662F\u9650\u5236\u5E94\u7528\u7A0B\u5E8F\u4E0D\u80FD\u540C\u65F6\u8FD0\u884C\u591A\u4E2A\u5B9E\u4F8B\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u6d9c4fbf\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EMutex\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5BF9\u8C61\u652F\u6301\u9012\u5F52\uFF0C\u4E5F\u5C31\u662F\u8BF4\u540C\u4E00\u4E2A\u7EBF\u7A0B\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u53EF\u591A\u6B21\u83B7\u53D6\u540C\u4E00\u4E2A\u9501\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u8FD9\u5728\u540E\u9762\u6F14\u793A\u4EE3\u7801\u4E2D\u53EF\u89C2\u5BDF\u5230\u3002\u7531\u4E8E\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EMutex\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7684\u57FA\u7C7B\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESystem.Theading.WaitHandle\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5B9E\u73B0\u4E86\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EIDisposable\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u63A5\u53E3\uFF0C\u6240\u4EE5\u5F53\u4E0D\u9700\u8981\u5728\u4F7F\u7528\u5B83\u65F6\u8981\u6CE8\u610F\u8FDB\u884C\u8D44\u6E90\u7684\u91CA\u653E\u3002\u66F4\u591A\u8D44\u6599\uFF1A\u003C/span\u003E\u003Ca href=\u0022https://msdn.microsoft.com/zh-cn/library/system.threading.mutex.aspx\u0022 data-href=\u0022https://msdn.microsoft.com/zh-cn/library/system.threading.mutex.aspx\u0022 target=\u0022_blank\u0022 class=\u0022ne-link\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u6233\u4E00\u6233\u003C/span\u003E\u003C/a\u003E\u003C/p\u003E\u003Cp id=\u0022ue5c4a7b4\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6F14\u793A\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF0C\u7B80\u5355\u7684\u6F14\u793A\u4E86\u5982\u4F55\u521B\u5EFA\u5355\u5B9E\u4F8B\u7684\u5E94\u7528\u7A0B\u5E8F\u548C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EMutex\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u9012\u5F52\u83B7\u53D6\u9501\u7684\u5B9E\u73B0\u3002\u003C/span\u003E\u003C/p\u003E\u003Cpre data-language=\u0022csharp\u0022 id=\u0022I5Wfz\u0022 class=\u0022ne-codeblock language-csharp\u0022\u003Econst string MutexName = \u0026quot;CSharpThreadingCookbook\u0026quot;;\n\nstatic void Main(string[] args)\n{\n    // \u4F7F\u7528using \u53CA\u65F6\u91CA\u653E\u8D44\u6E90\n    using (var m = new Mutex(false, MutexName))\n    {\n        if (!m.WaitOne(TimeSpan.FromSeconds(5), false))\n        {\n            Console.WriteLine(\u0026quot;\u5DF2\u7ECF\u6709\u5B9E\u4F8B\u6B63\u5728\u8FD0\u884C!\u0026quot;);\n        }\n        else\n        {\n            Console.WriteLine(\u0026quot;\u8FD0\u884C\u4E2D...\u0026quot;);\n\n            // \u6F14\u793A\u9012\u5F52\u83B7\u53D6\u9501\n            Recursion();\n\n            Console.ReadLine();\n            m.ReleaseMutex();\n        }\n    }\n\n    Console.ReadLine();\n}\n\nstatic void Recursion()\n{\n    using (var m = new Mutex(false, MutexName))\n    {\n        if (!m.WaitOne(TimeSpan.FromSeconds(2), false))\n        {\n            // \u56E0\u4E3AMutex\u652F\u6301\u9012\u5F52\u83B7\u53D6\u9501 \u6240\u4EE5\u6C38\u8FDC\u4E0D\u4F1A\u6267\u884C\u5230\u8FD9\u91CC\n            Console.WriteLine(\u0026quot;\u9012\u5F52\u83B7\u53D6\u9501\u5931\u8D25\uFF01\u0026quot;);\n        }\n        else\n        {\n            Console.WriteLine(\u0026quot;\u9012\u5F52\u83B7\u53D6\u9501\u6210\u529F\uFF01\u0026quot;);\n        }\n    }\n}\n\u003C/pre\u003E\u003Cp id=\u0022uf0888f94\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD0\u884C\u7ED3\u679C\u5982\u4E0B\u56FE\u6240\u793A\uFF0C\u6253\u5F00\u4E86\u4E24\u4E2A\u5E94\u7528\u7A0B\u5E8F\uFF0C\u56E0\u4E3A\u4F7F\u7528\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003EMutex\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5B9E\u73B0\u4E86\u5355\u5B9E\u4F8B\uFF0C\u6240\u4EE5\u7B2C\u4E8C\u4E2A\u5E94\u7528\u7A0B\u5E8F\u65E0\u6CD5\u83B7\u53D6\u9501\uFF0C\u5C31\u4F1A\u663E\u793A\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5DF2\u6709\u5B9E\u4F8B\u6B63\u5728\u8FD0\u884C\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u894f7fca\u0022 class=\u0022ne-p\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/1.png\u0022 width=\u00221026\u0022 id=\u0022uf8f6f119\u0022 class=\u0022ne-image\u0022\u003E\u003C/p\u003E\u003Ch2 id=\u0022Krj9y\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u4F7F\u7528SemaphoreSlim\u7C7B\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022u6b9d7ab0\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESemaphoreSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u4E0E\u4E4B\u524D\u63D0\u5230\u7684\u540C\u6B65\u7C7B\u6709\u9501\u4E0D\u540C\uFF0C\u4E4B\u524D\u63D0\u5230\u7684\u540C\u6B65\u7C7B\u90FD\u662F\u4E92\u65A5\u7684\uFF0C\u4E5F\u5C31\u662F\u8BF4\u53EA\u5141\u8BB8\u4E00\u4E2A\u7EBF\u7A0B\u8FDB\u884C\u8BBF\u95EE\u8D44\u6E90\uFF0C\u800C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESemaphoreSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u662F\u53EF\u4EE5\u5141\u8BB8\u591A\u4E2A\u8BBF\u95EE\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u0b50d8f7\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5728\u4E4B\u524D\u7684\u90E8\u5206\u6709\u63D0\u5230\uFF0C\u4EE5\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E*Slim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7ED3\u5C3E\u7684\u7EBF\u7A0B\u540C\u6B65\u7C7B\uFF0C\u90FD\u662F\u5DE5\u4F5C\u5728\u6DF7\u5408\u6A21\u5F0F\u4E0B\u7684\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5F00\u59CB\u5B83\u4EEC\u90FD\u662F\u5728\u7528\u6237\u6A21\u5F0F\u4E0B\u0026quot;\u81EA\u65CB\u0026quot;\uFF0C\u7B49\u53D1\u751F\u7B2C\u4E00\u6B21\u7ADE\u4E89\u65F6\uFF0C\u624D\u5207\u6362\u5230\u5185\u6838\u6A21\u5F0F\u3002\u4F46\u662F\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESemaphoreSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4E0D\u540C\u4E8E\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESemaphore\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\uFF0C\u5B83\u4E0D\u652F\u6301\u7CFB\u7EDF\u4FE1\u53F7\u91CF\uFF0C\u6240\u4EE5\u5B83\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4E0D\u80FD\u7528\u4E8E\u8FDB\u7A0B\u4E4B\u95F4\u7684\u540C\u6B65\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u296a442f\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8BE5\u7C7B\u4F7F\u7528\u6BD4\u8F83\u7B80\u5355\uFF0C\u6F14\u793A\u4EE3\u7801\u6F14\u793A\u4E866\u4E2A\u7EBF\u7A0B\u7ADE\u4E89\u8BBF\u95EE\u53EA\u5141\u8BB84\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8BBF\u95EE\u7684\u6570\u636E\u5E93\uFF0C\u5982\u4E0B\u6240\u793A\u3002\u003C/span\u003E\u003C/p\u003E\u003Cpre data-language=\u0022csharp\u0022 id=\u0022NuOX9\u0022 class=\u0022ne-codeblock language-csharp\u0022\u003Estatic void Main(string[] args)\n{\n    // \u521B\u5EFA6\u4E2A\u7EBF\u7A0B \u7ADE\u4E89\u8BBF\u95EEAccessDatabase\n    for (int i = 1; i \u0026lt;= 6; i\u002B\u002B)\n    {\n        string threadName = \u0026quot;\u7EBF\u7A0B \u0026quot; \u002B i;\n        // \u8D8A\u540E\u9762\u7684\u7EBF\u7A0B\uFF0C\u8BBF\u95EE\u65F6\u95F4\u8D8A\u4E45 \u65B9\u4FBF\u67E5\u770B\u6548\u679C\n        int secondsToWait = 2 \u002B 2 * i;\n        var t = new Thread(() =\u0026gt; AccessDatabase(threadName, secondsToWait));\n        t.Start();\n    }\n\n    Console.ReadLine();\n}\n\n// \u540C\u65F6\u5141\u8BB84\u4E2A\u7EBF\u7A0B\u8BBF\u95EE\nstatic SemaphoreSlim _semaphore = new SemaphoreSlim(4);\n\nstatic void AccessDatabase(string name, int seconds)\n{\n    Console.WriteLine($\u0026quot;{name} \u7B49\u5F85\u8BBF\u95EE\u6570\u636E\u5E93.... {DateTime.Now.ToString(\u0026quot;HH:mm:ss.ffff\u0026quot;)}\u0026quot;);\n\n    // \u7B49\u5F85\u83B7\u53D6\u9501 \u8FDB\u5165\u4E34\u754C\u533A\n    _semaphore.Wait();\n\n    Console.WriteLine($\u0026quot;{name} \u5DF2\u83B7\u53D6\u5BF9\u6570\u636E\u5E93\u7684\u8BBF\u95EE\u6743\u9650 {DateTime.Now.ToString(\u0026quot;HH:mm:ss.ffff\u0026quot;)}\u0026quot;);\n    // Do something\n    Thread.Sleep(TimeSpan.FromSeconds(seconds));\n\n    Console.WriteLine($\u0026quot;{name} \u8BBF\u95EE\u5B8C\u6210... {DateTime.Now.ToString(\u0026quot;HH:mm:ss.ffff\u0026quot;)}\u0026quot;);\n    // \u91CA\u653E\u9501\n    _semaphore.Release();\n}\n\u003C/pre\u003E\u003Cp id=\u0022udd7211cb\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD0\u884C\u7ED3\u679C\u5982\u4E0B\u6240\u793A\uFF0C\u53EF\u89C1\u524D4\u4E2A\u7EBF\u7A0B\u9A6C\u4E0A\u5C31\u83B7\u53D6\u5230\u4E86\u9501\uFF0C\u8FDB\u5165\u4E86\u4E34\u754C\u533A\uFF0C\u800C\u53E6\u5916\u4E24\u4E2A\u7EBF\u7A0B\u5728\u7B49\u5F85\uFF1B\u7B49\u6709\u9501\u88AB\u91CA\u653E\u65F6\uFF0C\u624D\u80FD\u8FDB\u5165\u4E34\u754C\u533A\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u4175aedc\u0022 class=\u0022ne-p\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/2.png\u0022 width=\u0022739\u0022 id=\u0022u902742f4\u0022 class=\u0022ne-image\u0022\u003E\u003C/p\u003E\u003Ch2 id=\u0022HHIQF\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u4F7F\u7528AutoResetEvent\u7C7B\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022u2213fbab\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EAutoResetEvent\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u53EB\u81EA\u52A8\u91CD\u7F6E\u4E8B\u4EF6\uFF0C\u867D\u7136\u540D\u79F0\u4E2D\u6709\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4E8B\u4EF6\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4E00\u8BCD\uFF0C\u4F46\u662F\u91CD\u7F6E\u4E8B\u4EF6\u548CC#\u4E2D\u7684\u59D4\u6258\u6CA1\u6709\u4EFB\u4F55\u5173\u7CFB\uFF0C\u8FD9\u91CC\u7684\u4E8B\u4EF6\u53EA\u662F\u7531\u5185\u6838\u7EF4\u62A4\u7684\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EBoolean\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u53D8\u91CF\uFF0C\u5F53\u4E8B\u4EF6\u4E3A\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Efalse\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u90A3\u4E48\u5728\u4E8B\u4EF6\u4E0A\u7B49\u5F85\u7684\u7EBF\u7A0B\u5C31\u963B\u585E\uFF1B\u4E8B\u4EF6\u53D8\u4E3A\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Etrue\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u90A3\u4E48\u963B\u585E\u89E3\u9664\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022uee2c61ba\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5728.Net\u4E2D\u6709\u4E24\u79CD\u6B64\u7C7B\u4E8B\u4EF6\uFF0C\u5373\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EAutoResetEvent\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E(\u81EA\u52A8\u91CD\u7F6E\u4E8B\u4EF6)\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u548C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EManualResetEvent\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E(\u624B\u52A8\u91CD\u7F6E\u4E8B\u4EF6)\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u3002\u8FD9\u4E24\u8005\u5747\u662F\u91C7\u7528\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5185\u6838\u6A21\u5F0F\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u5B83\u7684\u533A\u522B\u5728\u4E8E\u5F53\u91CD\u7F6E\u4E8B\u4EF6\u4E3A\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Etrue\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65F6\uFF0C\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u81EA\u52A8\u91CD\u7F6E\u4E8B\u4EF6\u5B83\u53EA\u5524\u9192\u4E00\u4E2A\u963B\u585E\u7684\u7EBF\u7A0B\uFF0C\u4F1A\u81EA\u52A8\u5C06\u4E8B\u4EF6\u91CD\u7F6E\u56DE\u003C/span\u003E\u003C/strong\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Efalse\u003C/span\u003E\u003C/strong\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u9020\u6210\u5176\u5B83\u7EBF\u7A0B\u7EE7\u7EED\u963B\u585E\u3002\u800C\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u624B\u52A8\u91CD\u7F6E\u4E8B\u4EF6\u4E0D\u4F1A\u81EA\u52A8\u91CD\u7F6E\uFF0C\u5FC5\u987B\u901A\u8FC7\u4EE3\u7801\u624B\u52A8\u91CD\u7F6E\u56DE\u003C/span\u003E\u003C/strong\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Efalse\u003C/span\u003E\u003C/strong\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u7558c2ba\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u56E0\u4E3A\u4EE5\u4E0A\u7684\u539F\u56E0\uFF0C\u6240\u4EE5\u5728\u5F88\u591A\u6587\u7AE0\u548C\u4E66\u7C4D\u4E2D\u4E0D\u63A8\u8350\u4F7F\u7528\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EAutoResetEvent\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E(\u81EA\u52A8\u91CD\u7F6E\u4E8B\u4EF6)\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\uFF0C\u56E0\u4E3A\u5B83\u5F88\u5BB9\u6613\u5728\u7F16\u5199\u751F\u4EA7\u8005\u7EBF\u7A0B\u65F6\u53D1\u751F\u5931\u8BEF\uFF0C\u9020\u6210\u5B83\u7684\u8FED\u4EE3\u6B21\u6570\u591A\u4F59\u6D88\u8D39\u8005\u7EBF\u7A0B\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u1b314210\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6F14\u793A\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF0C\u8BE5\u4EE3\u7801\u6F14\u793A\u4E86\u901A\u8FC7\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EAutoResetEvent\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5B9E\u73B0\u4E24\u4E2A\u7EBF\u7A0B\u7684\u4E92\u76F8\u540C\u6B65\u3002\u003C/span\u003E\u003C/p\u003E\u003Cpre data-language=\u0022csharp\u0022 id=\u0022SbiZd\u0022 class=\u0022ne-codeblock language-csharp\u0022\u003Estatic void Main(string[] args)\n{\n    var t = new Thread(() =\u0026gt; Process(10));\n    t.Start();\n\n    Console.WriteLine(\u0026quot;\u7B49\u5F85\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u5B8C\u6210\u5DE5\u4F5C\uFF01\u0026quot;);\n    // \u7B49\u5F85\u5DE5\u4F5C\u7EBF\u7A0B\u901A\u77E5 \u4E3B\u7EBF\u7A0B\u963B\u585E\n    _workerEvent.WaitOne();\n    Console.WriteLine(\u0026quot;\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u5DF2\u7ECF\u5B8C\u6210\uFF01\u0026quot;);\n    Console.WriteLine(\u0026quot;\u5728\u4E3B\u7EBF\u7A0B\u4E0A\u6267\u884C\u64CD\u4F5C\u0026quot;);\n    Thread.Sleep(TimeSpan.FromSeconds(5));\n\n    // \u53D1\u9001\u901A\u77E5 \u5DE5\u4F5C\u7EBF\u7A0B\u7EE7\u7EED\u8FD0\u884C\n    _mainEvent.Set();\n    Console.WriteLine(\u0026quot;\u73B0\u5728\u5728\u7B2C\u4E8C\u4E2A\u7EBF\u7A0B\u4E0A\u8FD0\u884C\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u0026quot;);\n\n    // \u7B49\u5F85\u5DE5\u4F5C\u7EBF\u7A0B\u901A\u77E5 \u4E3B\u7EBF\u7A0B\u963B\u585E\n    _workerEvent.WaitOne();\n    Console.WriteLine(\u0026quot;\u7B2C\u4E8C\u6B21\u64CD\u4F5C\u5B8C\u6210\uFF01\u0026quot;);\n\n    Console.ReadLine();\n}\n\n// \u5DE5\u4F5C\u7EBF\u7A0BEvent\nprivate static AutoResetEvent _workerEvent = new AutoResetEvent(false);\n// \u4E3B\u7EBF\u7A0BEvent\nprivate static AutoResetEvent _mainEvent = new AutoResetEvent(false);\n\nstatic void Process(int seconds)\n{\n    Console.WriteLine(\u0026quot;\u5F00\u59CB\u957F\u65F6\u95F4\u7684\u5DE5\u4F5C...\u0026quot;);\n    Thread.Sleep(TimeSpan.FromSeconds(seconds));\n    Console.WriteLine(\u0026quot;\u5DE5\u4F5C\u5B8C\u6210!\u0026quot;);\n\n    // \u53D1\u9001\u901A\u77E5 \u4E3B\u7EBF\u7A0B\u7EE7\u7EED\u8FD0\u884C\n    _workerEvent.Set();\n    Console.WriteLine(\u0026quot;\u7B49\u5F85\u4E3B\u7EBF\u7A0B\u5B8C\u6210\u5176\u5B83\u5DE5\u4F5C\u0026quot;);\n\n    // \u7B49\u5F85\u4E3B\u7EBF\u7A0B\u901A\u77E5 \u5DE5\u4F5C\u7EBF\u7A0B\u963B\u585E\n    _mainEvent.WaitOne();\n    Console.WriteLine(\u0026quot;\u542F\u52A8\u7B2C\u4E8C\u6B21\u64CD\u4F5C...\u0026quot;);\n    Thread.Sleep(TimeSpan.FromSeconds(seconds));\n    Console.WriteLine(\u0026quot;\u5DE5\u4F5C\u5B8C\u6210!\u0026quot;);\n\n    // \u53D1\u9001\u901A\u77E5 \u4E3B\u7EBF\u7A0B\u7EE7\u7EED\u8FD0\u884C\n    _workerEvent.Set();\n}\n\u003C/pre\u003E\u003Cp id=\u0022u73a3cb3d\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD0\u884C\u7ED3\u679C\u5982\u4E0B\u56FE\u6240\u793A\uFF0C\u4E0E\u9884\u671F\u7ED3\u679C\u7B26\u5408\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022uab4b74dd\u0022 class=\u0022ne-p\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/3.png\u0022 width=\u0022760\u0022 id=\u0022u86dafb0c\u0022 class=\u0022ne-image\u0022\u003E\u003C/p\u003E\u003Ch2 id=\u0022Lplwl\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u4F7F\u7528ManualResetEventSlim\u7C7B\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022uec1936a0\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EManualResetEventSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4F7F\u7528\u548C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EManualResetEvent\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u57FA\u672C\u4E00\u81F4\uFF0C\u53EA\u662F\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EManualResetEventSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5DE5\u4F5C\u5728\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6DF7\u5408\u6A21\u5F0F\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4E0B\uFF0C\u800C\u5B83\u4E0E\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EAutoResetEventSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4E0D\u540C\u7684\u5730\u65B9\u5C31\u662F\u9700\u8981\u624B\u52A8\u91CD\u7F6E\u4E8B\u4EF6\uFF0C\u4E5F\u5C31\u662F\u8C03\u7528\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EReset()\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u624D\u80FD\u5C06\u4E8B\u4EF6\u91CD\u7F6E\u4E3A\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Efalse\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u3ff937a6\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6F14\u793A\u4EE3\u7801\u5982\u4E0B\uFF0C\u5F62\u8C61\u7684\u5C06\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EManualResetEventSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6BD4\u55BB\u6210\u5927\u95E8\uFF0C\u5F53\u4E8B\u4EF6\u4E3A\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Etrue\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65F6\u5927\u95E8\u6253\u5F00\uFF0C\u7EBF\u7A0B\u89E3\u9664\u963B\u585E\uFF1B\u800C\u4E8B\u4EF6\u4E3A\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003Efalse\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65F6\u5927\u95E8\u5173\u95ED\uFF0C\u7EBF\u7A0B\u963B\u585E\u3002\u003C/span\u003E\u003C/p\u003E\u003Cpre data-language=\u0022csharp\u0022 id=\u0022V5jcf\u0022 class=\u0022ne-codeblock language-csharp\u0022\u003Estatic void Main(string[] args)\n{\n    var t1 = new Thread(() =\u0026gt; TravelThroughGates(\u0026quot;Thread 1\u0026quot;, 5));\n    var t2 = new Thread(() =\u0026gt; TravelThroughGates(\u0026quot;Thread 2\u0026quot;, 6));\n    var t3 = new Thread(() =\u0026gt; TravelThroughGates(\u0026quot;Thread 3\u0026quot;, 12));\n    t1.Start();\n    t2.Start();\n    t3.Start();\n    // \u4F11\u77206\u79D2\u949F  \u53EA\u6709Thread 1\u5C0F\u4E8E 6\u79D2\u949F\uFF0C\u6240\u4EE5\u4E8B\u4EF6\u91CD\u7F6E\u65F6 Thread 1 \u80AF\u5B9A\u80FD\u8FDB\u5165\u5927\u95E8  \u800C Thread 2 \u53EF\u80FD\u53EF\u4EE5\u8FDB\u5165\u5927\u95E8\n    Thread.Sleep(TimeSpan.FromSeconds(6));\n    Console.WriteLine($\u0026quot;\u5927\u95E8\u73B0\u5728\u6253\u5F00\u4E86!  \u65F6\u95F4\uFF1A{DateTime.Now.ToString(\u0026quot;mm:ss.ffff\u0026quot;)}\u0026quot;);\n    _mainEvent.Set();\n    // \u4F11\u77202\u79D2\u949F \u6B64\u65F6 Thread 2 \u80AF\u5B9A\u53EF\u4EE5\u8FDB\u5165\u5927\u95E8\n    Thread.Sleep(TimeSpan.FromSeconds(2));\n    _mainEvent.Reset();\n    Console.WriteLine($\u0026quot;\u5927\u95E8\u73B0\u5728\u5173\u95ED\u4E86! \u65F6\u95F4\uFF1A{DateTime.Now.ToString(\u0026quot;mm: ss.ffff\u0026quot;)}\u0026quot;);\n    // \u4F11\u772010\u79D2\u949F Thread 3 \u53EF\u4EE5\u8FDB\u5165\u5927\u95E8\n    Thread.Sleep(TimeSpan.FromSeconds(10));\n    Console.WriteLine($\u0026quot;\u5927\u95E8\u73B0\u5728\u7B2C\u4E8C\u6B21\u6253\u5F00! \u65F6\u95F4\uFF1A{DateTime.Now.ToString(\u0026quot;mm: ss.ffff\u0026quot;)}\u0026quot;);\n    _mainEvent.Set();\n    Thread.Sleep(TimeSpan.FromSeconds(2));\n    Console.WriteLine($\u0026quot;\u5927\u95E8\u73B0\u5728\u5173\u95ED\u4E86! \u65F6\u95F4\uFF1A{DateTime.Now.ToString(\u0026quot;mm: ss.ffff\u0026quot;)}\u0026quot;);\n    _mainEvent.Reset();\n    Console.ReadLine();\n}\nstatic void TravelThroughGates(string threadName, int seconds)\n{\n    Console.WriteLine($\u0026quot;{threadName} \u8FDB\u5165\u7761\u7720 \u65F6\u95F4\uFF1A{DateTime.Now.ToString(\u0026quot;mm:ss.ffff\u0026quot;)}\u0026quot;);\n    Thread.Sleep(TimeSpan.FromSeconds(seconds));\n    Console.WriteLine($\u0026quot;{threadName} \u7B49\u5F85\u5927\u95E8\u6253\u5F00! \u65F6\u95F4\uFF1A{DateTime.Now.ToString(\u0026quot;mm:ss.ffff\u0026quot;)}\u0026quot;);\n    _mainEvent.Wait();\n    Console.WriteLine($\u0026quot;{threadName} \u8FDB\u5165\u5927\u95E8! \u65F6\u95F4\uFF1A{DateTime.Now.ToString(\u0026quot;mm:ss.ffff\u0026quot;)}\u0026quot;);\n}\nstatic ManualResetEventSlim _mainEvent = new ManualResetEventSlim(false);\u003C/pre\u003E\u003Cp id=\u0022u66c9bf5c\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD0\u884C\u7ED3\u679C\u5982\u4E0B\uFF0C\u4E0E\u9884\u671F\u7ED3\u679C\u76F8\u7B26\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u9aa2cff5\u0022 class=\u0022ne-p\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/4.png\u0022 width=\u0022771\u0022 id=\u0022u62fcc003\u0022 class=\u0022ne-image\u0022\u003E\u003C/p\u003E\u003Ch2 id=\u0022fZr81\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u4F7F\u7528CountDownEvent\u7C7B\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022uc33a5de2\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ECountDownEvent\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u5185\u90E8\u6784\u9020\u4F7F\u7528\u4E86\u4E00\u4E2A\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EManualResetEventSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5BF9\u8C61\u3002\u8FD9\u4E2A\u6784\u9020\u963B\u585E\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u76F4\u5230\u5B83\u5185\u90E8\u8BA1\u6570\u5668\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E(\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ECurrentCount\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E)\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u53D8\u4E3A\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65F6\uFF0C\u624D\u89E3\u9664\u963B\u585E\u3002\u4E5F\u5C31\u662F\u8BF4\u5B83\u5E76\u4E0D\u662F\u963B\u6B62\u5BF9\u5DF2\u7ECF\u67AF\u7AED\u7684\u8D44\u6E90\u6C60\u7684\u8BBF\u95EE\uFF0C\u800C\u662F\u53EA\u6709\u5F53\u8BA1\u6570\u4E3A\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65F6\u624D\u5141\u8BB8\u8BBF\u95EE\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022uda9294af\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD9\u91CC\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5F53\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ECurrentCount\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u53D8\u4E3A\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65F6\uFF0C\u90A3\u4E48\u5B83\u5C31\u4E0D\u80FD\u88AB\u66F4\u6539\u4E86\u3002\u4E3A\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E0\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4EE5\u540E\uFF0C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EWait()\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65B9\u6CD5\u7684\u963B\u585E\u88AB\u89E3\u9664\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022uc204ab15\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6F14\u793A\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF0C\u53EA\u6709\u5F53\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESignal()\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65B9\u6CD5\u88AB\u8C03\u75282\u6B21\u4EE5\u540E\uFF0C\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EWait()\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u65B9\u6CD5\u7684\u963B\u585E\u624D\u88AB\u89E3\u9664\u3002\u003C/span\u003E\u003C/p\u003E\u003Cpre data-language=\u0022csharp\u0022 id=\u0022VjvgH\u0022 class=\u0022ne-codeblock language-csharp\u0022\u003Estatic void Main(string[] args)\n{\n    Console.WriteLine($\u0026quot;\u5F00\u59CB\u4E24\u4E2A\u64CD\u4F5C  {DateTime.Now.ToString(\u0026quot;mm:ss.ffff\u0026quot;)}\u0026quot;);\n    var t1 = new Thread(() =\u0026gt; PerformOperation(\u0026quot;\u64CD\u4F5C 1 \u5B8C\u6210\uFF01\u0026quot;, 4));\n    var t2 = new Thread(() =\u0026gt; PerformOperation(\u0026quot;\u64CD\u4F5C 2 \u5B8C\u6210\uFF01\u0026quot;, 8));\n    t1.Start();\n    t2.Start();\n\n    // \u7B49\u5F85\u64CD\u4F5C\u5B8C\u6210\n    _countdown.Wait();\n    Console.WriteLine($\u0026quot;\u6240\u6709\u64CD\u4F5C\u90FD\u5B8C\u6210  {DateTime.Now.ToString(\u0026quot;mm: ss.ffff\u0026quot;)}\u0026quot;);\n    _countdown.Dispose();\n\n    Console.ReadLine();\n}\n\n// \u6784\u9020\u51FD\u6570\u7684\u53C2\u6570\u4E3A2 \u8868\u793A\u53EA\u6709\u8C03\u7528\u4E86\u4E24\u6B21 Signal\u65B9\u6CD5 CurrentCount \u4E3A 0\u65F6  Wait\u7684\u963B\u585E\u624D\u89E3\u9664\nstatic CountdownEvent _countdown = new CountdownEvent(2);\n\nstatic void PerformOperation(string message, int seconds)\n{\n    Thread.Sleep(TimeSpan.FromSeconds(seconds));\n    Console.WriteLine($\u0026quot;{message}  {DateTime.Now.ToString(\u0026quot;mm:ss.ffff\u0026quot;)}\u0026quot;);\n\n    // CurrentCount \u9012\u51CF 1\n    _countdown.Signal();\n}\u003C/pre\u003E\u003Cp id=\u0022u31aa2fda\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD0\u884C\u7ED3\u679C\u5982\u4E0B\u56FE\u6240\u793A\uFF0C\u53EF\u89C1\u53EA\u6709\u5F53\u64CD\u4F5C1\u548C\u64CD\u4F5C2\u90FD\u5B8C\u6210\u4EE5\u540E\uFF0C\u624D\u6267\u884C\u8F93\u51FA\u6240\u6709\u64CD\u4F5C\u90FD\u5B8C\u6210\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u44b68a2c\u0022 class=\u0022ne-p\u0022\u003E\u003Ca href=\u0022https://images2018.cnblogs.com/blog/997046/201808/997046-20180803213629728-1953466335.png\u0022 target=\u0022_blank\u0022 id=\u0022uae386719\u0022 class=\u0022ne-image-link\u0022 style=\u0022font-size: 16px\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/5.png\u0022 width=\u0022802\u0022 class=\u0022ne-image\u0022\u003E\u003C/a\u003E\u003C/p\u003E\u003Ch2 id=\u0022NzeJ9\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u4F7F\u7528Barrier\u7C7B\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022u73cada91\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EBarrier\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u7528\u4E8E\u89E3\u51B3\u4E00\u4E2A\u975E\u5E38\u7A00\u6709\u7684\u95EE\u9898\uFF0C\u5E73\u65F6\u4E00\u822C\u7528\u4E0D\u4E0A\u3002\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EBarrier\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u63A7\u5236\u4E00\u7CFB\u5217\u7EBF\u7A0B\u8FDB\u884C\u9636\u6BB5\u6027\u7684\u5E76\u884C\u5DE5\u4F5C\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u362c9210\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5047\u8BBE\u73B0\u5728\u5E76\u884C\u5DE5\u4F5C\u5206\u4E3A2\u4E2A\u9636\u6BB5\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u5728\u5B8C\u6210\u5B83\u81EA\u5DF1\u90A3\u90E8\u5206\u9636\u6BB51\u7684\u5DE5\u4F5C\u540E\uFF0C\u5FC5\u987B\u505C\u4E0B\u6765\u7B49\u5F85\u5176\u5B83\u7EBF\u7A0B\u5B8C\u6210\u9636\u6BB51\u7684\u5DE5\u4F5C\uFF1B\u7B49\u6240\u6709\u7EBF\u7A0B\u5747\u5B8C\u6210\u9636\u6BB51\u5DE5\u4F5C\u540E\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u53C8\u5F00\u59CB\u8FD0\u884C\uFF0C\u5B8C\u6210\u9636\u6BB52\u5DE5\u4F5C\uFF0C\u7B49\u5F85\u5176\u5B83\u7EBF\u7A0B\u5168\u90E8\u5B8C\u6210\u9636\u6BB52\u5DE5\u4F5C\u540E\uFF0C\u6574\u4E2A\u6D41\u7A0B\u624D\u7ED3\u675F\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u5d139383\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6F14\u793A\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF0C\u8BE5\u4EE3\u7801\u6F14\u793A\u4E86\u4E24\u4E2A\u7EBF\u7A0B\u5206\u9636\u6BB5\u7684\u5B8C\u6210\u5DE5\u4F5C\u3002\u003C/span\u003E\u003C/p\u003E\u003Cpre data-language=\u0022csharp\u0022 id=\u0022IbZ0K\u0022 class=\u0022ne-codeblock language-csharp\u0022\u003Estatic void Main(string[] args)\n{\n    var t1 = new Thread(() =\u0026gt; PlayMusic(\u0026quot;\u94A2\u7434\u5BB6\u0026quot;, \u0026quot;\u6F14\u594F\u4E00\u9996\u4EE4\u4EBA\u60CA\u53F9\u7684\u72EC\u594F\u66F2\u0026quot;, 5));\n    var t2 = new Thread(() =\u0026gt; PlayMusic(\u0026quot;\u6B4C\u624B\u0026quot;, \u0026quot;\u5531\u7740\u4ED6\u7684\u6B4C\u0026quot;, 2));\n\n    t1.Start();\n    t2.Start();\n\n    Console.ReadLine();\n}\n\nstatic Barrier _barrier = new Barrier(2, Console.WriteLine($\u0026quot;\u7B2C {b.CurrentPhaseNumber \u002B 1} \u9636\u6BB5\u7ED3\u675F\u0026quot;));\n\nstatic void PlayMusic(string name, string message, int seconds)\n{\n    for (int i = 1; i \u0026lt; 3; i\u002B\u002B)\n    {\n        Console.WriteLine(\u0026quot;----------------------------------------------\u0026quot;);\n        Thread.Sleep(TimeSpan.FromSeconds(seconds));\n        Console.WriteLine($\u0026quot;{name} \u5F00\u59CB {message}\u0026quot;);\n        Thread.Sleep(TimeSpan.FromSeconds(seconds));\n        Console.WriteLine($\u0026quot;{name} \u7ED3\u675F {message}\u0026quot;);\n        _barrier.SignalAndWait();\n    }\n}\u003C/pre\u003E\u003Cp id=\u0022ue7253835\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD0\u884C\u7ED3\u679C\u5982\u4E0B\u6240\u793A\uFF0C\u5F53\u201C\u6B4C\u624B\u201D\u7EBF\u7A0B\u5B8C\u6210\u540E\uFF0C\u5E76\u6CA1\u6709\u9A6C\u4E0A\u7ED3\u675F\uFF0C\u800C\u662F\u7B49\u5F85\u201C\u94A2\u7434\u5BB6\u201D\u7EBF\u7A0B\u7ED3\u675F\uFF0C\u5F53\u0026quot;\u94A2\u7434\u5BB6\u0026quot;\u7EBF\u7A0B\u7ED3\u675F\u540E\uFF0C\u624D\u5F00\u59CB\u7B2C2\u9636\u6BB5\u7684\u5DE5\u4F5C\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u770fd154\u0022 class=\u0022ne-p\u0022\u003E\u003Ca href=\u0022https://images2018.cnblogs.com/blog/997046/201808/997046-20180803213629433-1754678694.png\u0022 target=\u0022_blank\u0022 id=\u0022uecea8fc8\u0022 class=\u0022ne-image-link\u0022 style=\u0022font-size: 16px\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/6.png\u0022 width=\u0022727\u0022 class=\u0022ne-image\u0022\u003E\u003C/a\u003E\u003C/p\u003E\u003Ch2 id=\u0022mHpin\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u4F7F\u7528ReaderWriterLockSlim\u7C7B\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022u79ebfc45\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EReaderWriterLockSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u4E3B\u8981\u662F\u89E3\u51B3\u5728\u67D0\u4E9B\u573A\u666F\u4E0B\uFF0C\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8BFB\u64CD\u4F5C\u591A\u4E8E\u5199\u64CD\u4F5C\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u800C\u4F7F\u7528\u67D0\u4E9B\u4E92\u65A5\u9501\u5F53\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8BBF\u95EE\u8D44\u6E90\u65F6\uFF0C\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u80FD\u8BBF\u95EE\uFF0C\u5BFC\u81F4\u6027\u80FD\u6025\u5267\u4E0B\u964D\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u3153a865\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5982\u679C\u6240\u6709\u7EBF\u7A0B\u90FD\u5E0C\u671B\u4EE5\u53EA\u8BFB\u7684\u65B9\u5F0F\u8BBF\u95EE\u6570\u636E\uFF0C\u5C31\u6839\u672C\u6CA1\u6709\u5FC5\u8981\u963B\u585E\u5B83\u4EEC\uFF1B\u5982\u679C\u4E00\u4E2A\u7EBF\u7A0B\u5E0C\u671B\u4FEE\u6539\u6570\u636E\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u7EBF\u7A0B\u624D\u9700\u8981\u72EC\u5360\u8BBF\u95EE\uFF0C\u8FD9\u5C31\u662F\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EReaderWriterLockSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7684\u5178\u578B\u5E94\u7528\u573A\u666F\u3002\u8FD9\u4E2A\u7C7B\u5C31\u50CF\u4E0B\u9762\u8FD9\u6837\u6765\u63A7\u5236\u7EBF\u7A0B\u3002\u003C/span\u003E\u003C/p\u003E\u003Cdiv class=\u0022ne-quote\u0022\u003E\u003Cul class=\u0022ne-ul\u0022\u003E\u003Cli id=\u0022u1d19f797\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4E00\u4E2A\u7EBF\u7A0B\u5411\u6570\u636E\u5199\u5165\u662F\uFF0C\u8BF7\u6C42\u8BBF\u95EE\u7684\u5176\u4ED6\u6240\u6709\u7EBF\u7A0B\u90FD\u88AB\u963B\u585E\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022ubb12f96c\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4E00\u4E2A\u7EBF\u7A0B\u8BFB\u53D6\u6570\u636E\u65F6\uFF0C\u8BF7\u6C42\u8BFB\u53D6\u7684\u7EBF\u7A0B\u5141\u8BB8\u8BFB\u53D6\uFF0C\u800C\u8BF7\u6C42\u5199\u5165\u7684\u7EBF\u7A0B\u88AB\u963B\u585E\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022u7e0c8468\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5199\u5165\u7EBF\u7A0B\u7ED3\u675F\u540E\uFF0C\u8981\u4E48\u89E3\u9664\u4E00\u4E2A\u5199\u5165\u7EBF\u7A0B\u7684\u963B\u585E\uFF0C\u4F7F\u5199\u5165\u7EBF\u7A0B\u80FD\u5411\u6570\u636E\u63A5\u5165\uFF0C\u8981\u4E48\u89E3\u9664\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u6240\u6709\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8BFB\u53D6\u7EBF\u7A0B\u7684\u963B\u585E\uFF0C\u4F7F\u5B83\u4EEC\u80FD\u5E76\u53D1\u8BFB\u53D6\u6570\u636E\u3002\u5982\u679C\u7EBF\u7A0B\u6CA1\u6709\u88AB\u963B\u585E\uFF0C\u9501\u5C31\u53EF\u4EE5\u8FDB\u5165\u81EA\u7531\u4F7F\u7528\u7684\u72B6\u6001\uFF0C\u53EF\u4F9B\u4E0B\u4E00\u4E2A\u8BFB\u7EBF\u7A0B\u6216\u5199\u7EBF\u7A0B\u83B7\u53D6\u3002\u003C/span\u003E\u003C/li\u003E\u003Cli id=\u0022uf3129a24\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u4ECE\u6570\u636E\u8BFB\u53D6\u7684\u6240\u6709\u7EBF\u7A0B\u7ED3\u675F\u540E\uFF0C\u4E00\u4E2A\u5199\u7EBF\u7A0B\u88AB\u89E3\u9664\u963B\u585E\uFF0C\u4F7F\u5B83\u80FD\u5411\u6570\u636E\u5199\u5165\u3002\u5982\u679C\u7EBF\u7A0B\u6CA1\u6709\u88AB\u963B\u585E\uFF0C\u9501\u5C31\u53EF\u4EE5\u8FDB\u5165\u81EA\u7531\u4F7F\u7528\u7684\u72B6\u6001\uFF0C\u53EF\u4F9B\u4E0B\u4E00\u4E2A\u8BFB\u7EBF\u7A0B\u6216\u5199\u7EBF\u7A0B\u83B7\u53D6\u3002\u003C/span\u003E\u003C/li\u003E\u003C/ul\u003E\u003C/div\u003E\u003Cp id=\u0022ub8e0d17f\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EReaderWriterLockSlim\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD8\u652F\u6301\u4ECE\u003C/span\u003E\u003Cstrong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8BFB\u7EBF\u7A0B\u5347\u7EA7\u4E3A\u5199\u7EBF\u7A0B\u003C/span\u003E\u003C/strong\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7684\u64CD\u4F5C\uFF0C\u8BE6\u60C5\u8BF7\u003C/span\u003E\u003Ca href=\u0022https://msdn.microsoft.com/zh-cn/library/system.threading.readerwriterlockslim(v=vs.110).aspx\u0022 data-href=\u0022https://msdn.microsoft.com/zh-cn/library/system.threading.readerwriterlockslim(v=vs.110).aspx\u0022 target=\u0022_blank\u0022 class=\u0022ne-link\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u6233\u4E00\u6233\u003C/span\u003E\u003C/a\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u3002\u6587\u672C\u4E0D\u4F5C\u4ECB\u7ECD\u3002\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EReaderWriterLock\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u7C7B\u5DF2\u7ECF\u8FC7\u65F6\uFF0C\u800C\u4E14\u5B58\u5728\u8BB8\u591A\u95EE\u9898\uFF0C\u6CA1\u6709\u5FC5\u8981\u53BB\u4F7F\u7528\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022uddc152b9\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF0C\u521B\u5EFA\u4E863\u4E2A\u8BFB\u7EBF\u7A0B\uFF0C2\u4E2A\u5199\u7EBF\u7A0B\uFF0C\u8BFB\u7EBF\u7A0B\u548C\u5199\u7EBF\u7A0B\u7ADE\u4E89\u83B7\u53D6\u9501\u3002\u003C/span\u003E\u003C/p\u003E\u003Cpre data-language=\u0022csharp\u0022 id=\u0022K9JSx\u0022 class=\u0022ne-codeblock language-csharp\u0022\u003Estatic void Main(string[] args)\n{\n    // \u521B\u5EFA3\u4E2A \u8BFB\u7EBF\u7A0B\n    new Thread(() =\u0026gt; Read(\u0026quot;Reader 1\u0026quot;)) { IsBackground = true }.Start();\n    new Thread(() =\u0026gt; Read(\u0026quot;Reader 2\u0026quot;)) { IsBackground = true }.Start();\n    new Thread(() =\u0026gt; Read(\u0026quot;Reader 3\u0026quot;)) { IsBackground = true }.Start();\n\n    // \u521B\u5EFA\u4E24\u4E2A\u5199\u7EBF\u7A0B\n    new Thread(() =\u0026gt; Write(\u0026quot;Writer 1\u0026quot;)) { IsBackground = true }.Start();\n    new Thread(() =\u0026gt; Write(\u0026quot;Writer 2\u0026quot;)) { IsBackground = true }.Start();\n\n    // \u4F7F\u7A0B\u5E8F\u8FD0\u884C30S\n    Thread.Sleep(TimeSpan.FromSeconds(30));\n\n    Console.ReadLine();\n}\n\nstatic ReaderWriterLockSlim _rw = new ReaderWriterLockSlim();\nstatic Dictionary\u0026lt;int, int\u0026gt; _items = new Dictionary\u0026lt;int, int\u0026gt;();\n\nstatic void Read(string threadName)\n{\n    while (true)\n    {\n        try\n        {\n            // \u83B7\u53D6\u8BFB\u9501\u5B9A\n            _rw.EnterReadLock();\n            Console.WriteLine($\u0026quot;{threadName} \u4ECE\u5B57\u5178\u4E2D\u8BFB\u53D6\u5185\u5BB9  {DateTime.Now.ToString(\u0026quot;mm:ss.ffff\u0026quot;)}\u0026quot;);\n            foreach (var key in _items.Keys)\n            {\n                Thread.Sleep(TimeSpan.FromSeconds(0.1));\n            }\n        }\n        finally\n        {\n            // \u91CA\u653E\u8BFB\u9501\u5B9A\n            _rw.ExitReadLock();\n        }\n    }\n}\n\nstatic void Write(string threadName)\n{\n    while (true)\n    {\n        try\n        {\n            int newKey = new Random().Next(250);\n            // \u5C1D\u8BD5\u8FDB\u5165\u53EF\u5347\u7EA7\u9501\u6A21\u5F0F\u72B6\u6001\n            _rw.EnterUpgradeableReadLock();\n            if (!_items.ContainsKey(newKey))\n            {\n                try\n                {\n                    // \u83B7\u53D6\u5199\u9501\u5B9A\n                    _rw.EnterWriteLock();\n                    _items[newKey] = 1;\n                    Console.WriteLine($\u0026quot;{threadName} \u5C06\u65B0\u7684\u952E {newKey} \u6DFB\u52A0\u8FDB\u5165\u5B57\u5178\u4E2D  {DateTime.Now.ToString(\u0026quot;mm:ss.ffff\u0026quot;)}\u0026quot;);\n                }\n                finally\n                {\n                    // \u91CA\u653E\u5199\u9501\u5B9A\n                    _rw.ExitWriteLock();\n                }\n            }\n            Thread.Sleep(TimeSpan.FromSeconds(0.1));\n        }\n        finally\n        {\n            // \u51CF\u5C11\u53EF\u5347\u7EA7\u6A21\u5F0F\u9012\u5F52\u8BA1\u6570\uFF0C\u5E76\u5728\u8BA1\u6570\u4E3A0\u65F6  \u63A8\u51FA\u53EF\u5347\u7EA7\u6A21\u5F0F\n            _rw.ExitUpgradeableReadLock();\n        }\n    }\n}\u003C/pre\u003E\u003Cp id=\u0022u67744c2b\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD0\u884C\u7ED3\u679C\u5982\u4E0B\u6240\u793A\uFF0C\u4E0E\u9884\u671F\u7ED3\u679C\u76F8\u7B26\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u4ab98454\u0022 class=\u0022ne-p\u0022\u003E\u003Ca href=\u0022https://images2018.cnblogs.com/blog/997046/201808/997046-20180803213629158-1425585239.png\u0022 target=\u0022_blank\u0022 id=\u0022u126c7020\u0022 class=\u0022ne-image-link\u0022 style=\u0022font-size: 16px\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/7.png\u0022 width=\u0022981\u0022 class=\u0022ne-image\u0022\u003E\u003C/a\u003E\u003C/p\u003E\u003Ch2 id=\u0022Yrzt2\u0022\u003E\u003Cspan class=\u0022ne-text\u0022\u003E\u4F7F\u7528SpinWait\u7C7B\u003C/span\u003E\u003C/h2\u003E\u003Cp id=\u0022u5c61b6ec\u0022 class=\u0022ne-p\u0022\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESpinWait\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u662F\u4E00\u4E2A\u5E38\u7528\u7684\u6DF7\u5408\u6A21\u5F0F\u7684\u7C7B\uFF0C\u5B83\u88AB\u8BBE\u8BA1\u6210\u4F7F\u7528\u7528\u6237\u6A21\u5F0F\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\uFF0C\u4EBA\u540E\u5207\u6362\u81F3\u5185\u6838\u6A21\u5F0F\u4EE5\u8282\u7701CPU\u65F6\u95F4\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022u6a131a1c\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5B83\u7684\u4F7F\u7528\u975E\u5E38\u7B80\u5355\uFF0C\u6F14\u793A\u4EE3\u7801\u5982\u4E0B\u6240\u793A\u3002\u003C/span\u003E\u003C/p\u003E\u003Cpre data-language=\u0022csharp\u0022 id=\u0022uigIt\u0022 class=\u0022ne-codeblock language-csharp\u0022\u003Estatic void Main(string[] args)\n{\n    var t1 = new Thread(UserModeWait);\n    var t2 = new Thread(HybridSpinWait);\n\n    Console.WriteLine(\u0026quot;\u8FD0\u884C\u5728\u7528\u6237\u6A21\u5F0F\u4E0B\u0026quot;);\n    t1.Start();\n    Thread.Sleep(20);\n    _isCompleted = true;\n    Thread.Sleep(TimeSpan.FromSeconds(1));\n    _isCompleted = false;\n\n    Console.WriteLine(\u0026quot;\u8FD0\u884C\u5728\u6DF7\u5408\u6A21\u5F0F\u4E0B\u0026quot;);\n    t2.Start();\n    Thread.Sleep(5);\n    _isCompleted = true;\n\n    Console.ReadLine();\n}\n\nstatic volatile bool _isCompleted = false;\n\nstatic void UserModeWait()\n{\n    while (!_isCompleted)\n    {\n        Console.Write(\u0026quot;.\u0026quot;);\n    }\n    Console.WriteLine();\n    Console.WriteLine(\u0026quot;\u7B49\u5F85\u7ED3\u675F\u0026quot;);\n}\n\nstatic void HybridSpinWait()\n{\n    var w = new SpinWait();\n    while (!_isCompleted)\n    {\n        w.SpinOnce();\n        Console.WriteLine(w.NextSpinWillYield);\n    }\n    Console.WriteLine(\u0026quot;\u7B49\u5F85\u7ED3\u675F\u0026quot;);\n}\u003C/pre\u003E\u003Cp id=\u0022ue71d1986\u0022 class=\u0022ne-p\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u8FD0\u884C\u7ED3\u679C\u5982\u4E0B\u4E24\u56FE\u6240\u793A\uFF0C\u9996\u5148\u7A0B\u5E8F\u8FD0\u884C\u5728\u6A21\u62DF\u7684\u7528\u6237\u6A21\u5F0F\u4E0B\uFF0C\u4F7FCPU\u6709\u4E00\u4E2A\u77ED\u6682\u7684\u5CF0\u503C\u3002\u7136\u540E\u4F7F\u7528\u003C/span\u003E\u003Ccode class=\u0022ne-code\u0022\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003ESpinWait\u003C/span\u003E\u003C/code\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5DE5\u4F5C\u5728\u6DF7\u5408\u6A21\u5F0F\u4E0B\uFF0C\u9996\u5148\u6807\u5FD7\u53D8\u91CF\u4E3A\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003EFalse\u003C/span\u003E\u003Cspan class=\u0022ne-text\u0022 style=\u0022font-size: 16px\u0022\u003E\u5904\u4E8E\u7528\u6237\u6A21\u5F0F\u81EA\u65CB\u4E2D\uFF0C\u7B49\u5F85\u4EE5\u540E\u8FDB\u5165\u5185\u6838\u6A21\u5F0F\u3002\u003C/span\u003E\u003C/p\u003E\u003Cp id=\u0022uf6085883\u0022 class=\u0022ne-p\u0022\u003E\u003Ca href=\u0022https://images2018.cnblogs.com/blog/997046/201808/997046-20180803213628846-1210659215.png\u0022 target=\u0022_blank\u0022 id=\u0022uc77a69a5\u0022 class=\u0022ne-image-link\u0022 style=\u0022font-size: 16px\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/8.png\u0022 width=\u0022979\u0022 class=\u0022ne-image\u0022\u003E\u003C/a\u003E\u003C/p\u003E\u003Cp id=\u0022u2744fd98\u0022 class=\u0022ne-p\u0022\u003E\u003Cimg src=\u0022https://raw.githubusercontent.com/cadengao/cadengao.github.io/blog_file//doc/54197715.119879742/image/9.png\u0022 width=\u0022799\u0022 id=\u0022ueab1ea21\u0022 class=\u0022ne-image\u0022\u003E\u003C/p\u003E\u003C/div\u003E",
  "Body": null,
  "CosUpdatedAt": "0001-01-01T00:00:00",
  "BodyHtmlCosUrl": null
}